<?xml version="1.0" encoding="UTF-8"?>
<policies>
	<policy>
		<resource type="column"
			description="A nurse can access a patient's reports only when the nurse and a doctor are present in patient's room">
			/PatientInfoSystem/Patient/patient_reports
		</resource>
		<permission>
			<value>
				read
			</value>
			<condition>
				<and>
					<and>
						<equal>
							<op1>
								/PatientInfoSystem/Patient(key=thisKey)/location
							</op1>
							<op2>
								/PatientInfoSystem/Patient(key=thisKey)/nurse_location
							</op2>
						</equal>
						<equal>
							<op1>
								/PatientInfoSystem/Patient(key=thisKey)/nurse_location
							</op1>
							<op2>
								/PatientInfoSystem/Patient(key=thisKey)/doctor_location
							</op2>
						</equal>
					</and>
					<equal>
						<op1>
							/PatientInfoSystem/Patient(key=thisKey)/nurse
						</op1>
						<op2>
							user.name
						</op2>
					</equal>
				</and>
			</condition>
		</permission>
	</policy>

	<policy>
		<resource type="column"
			description="A nurse can access a patient's reports only when the nurse and a doctor are present in patient's room">
			/PatientInfoSystem/Patient/patient_reports_20
		</resource>
		<permission>
			<value>
				read
			</value>
			<condition>
				<and>
					<and>
						<and>
							<equal>
								<op1>
									/PatientInfoSystem/Patient(key=thisKey)/location
								</op1>
								<op2>
									/PatientInfoSystem/Nurse(key=user.name)/location
								</op2>
							</equal>
							<equal>
								<op1>
									/PatientInfoSystem/Nurse(key=user.name)/location
								</op1>
								<op2>
									/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
								</op2>
							</equal>
						</and>
						<and>
							<equal>
								<op1>
									/PatientInfoSystem/Patient(key=thisKey)/location
								</op1>
								<op2>
									/PatientInfoSystem/Nurse(key=user.name)/location
								</op2>
							</equal>
							<equal>
								<op1>
									/PatientInfoSystem/Nurse(key=user.name)/location
								</op1>
								<op2>
									/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
								</op2>
							</equal>
						</and>
					</and>
					<and>
						<and>
							<equal>
								<op1>
									/PatientInfoSystem/Patient(key=thisKey)/location
								</op1>
								<op2>
									/PatientInfoSystem/Nurse(key=user.name)/location
								</op2>
							</equal>
							<equal>
								<op1>
									/PatientInfoSystem/Nurse(key=user.name)/location
								</op1>
								<op2>
									/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
								</op2>
							</equal>
						</and>
						<and>
							<equal>
								<op1>
									/PatientInfoSystem/Patient(key=thisKey)/location
								</op1>
								<op2>
									/PatientInfoSystem/Nurse(key=user.name)/location
								</op2>
							</equal>
							<equal>
								<op1>
									/PatientInfoSystem/Nurse(key=user.name)/location
								</op1>
								<op2>
									/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
								</op2>
							</equal>
						</and>
					</and>
				</and>
			</condition>
		</permission>
	</policy>

	<policy>
		<resource type="column"
			description="A nurse can access a patient's reports only when the nurse and a doctor are present in patient's room">
			/PatientInfoSystem/Patient/patient_reports_40
		</resource>
		<permission>
			<value>
				read
			</value>
			<condition>
				<and>
					<and>
						<and>
							<and>
								<equal>
									<op1>
										/PatientInfoSystem/Patient(key=thisKey)/location
									</op1>
									<op2>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op2>
								</equal>
								<equal>
									<op1>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op1>
									<op2>
										/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
									</op2>
								</equal>
							</and>
							<and>
								<equal>
									<op1>
										/PatientInfoSystem/Patient(key=thisKey)/location
									</op1>
									<op2>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op2>
								</equal>
								<equal>
									<op1>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op1>
									<op2>
										/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
									</op2>
								</equal>
							</and>
						</and>
						<and>
							<and>
								<equal>
									<op1>
										/PatientInfoSystem/Patient(key=thisKey)/location
									</op1>
									<op2>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op2>
								</equal>
								<equal>
									<op1>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op1>
									<op2>
										/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
									</op2>
								</equal>
							</and>
							<and>
								<equal>
									<op1>
										/PatientInfoSystem/Patient(key=thisKey)/location
									</op1>
									<op2>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op2>
								</equal>
								<equal>
									<op1>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op1>
									<op2>
										/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
									</op2>
								</equal>
							</and>
						</and>
					</and>

					<and>
						<and>
							<and>
								<equal>
									<op1>
										/PatientInfoSystem/Patient(key=thisKey)/location
									</op1>
									<op2>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op2>
								</equal>
								<equal>
									<op1>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op1>
									<op2>
										/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
									</op2>
								</equal>
							</and>
							<and>
								<equal>
									<op1>
										/PatientInfoSystem/Patient(key=thisKey)/location
									</op1>
									<op2>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op2>
								</equal>
								<equal>
									<op1>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op1>
									<op2>
										/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
									</op2>
								</equal>
							</and>
						</and>
						<and>
							<and>
								<equal>
									<op1>
										/PatientInfoSystem/Patient(key=thisKey)/location
									</op1>
									<op2>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op2>
								</equal>
								<equal>
									<op1>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op1>
									<op2>
										/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
									</op2>
								</equal>
							</and>
							<and>
								<equal>
									<op1>
										/PatientInfoSystem/Patient(key=thisKey)/location
									</op1>
									<op2>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op2>
								</equal>
								<equal>
									<op1>
										/PatientInfoSystem/Nurse(key=user.name)/location
									</op1>
									<op2>
										/PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
									</op2>
								</equal>
							</and>
						</and>
					</and>
				</and>
			</condition>
		</permission>
	</policy>
</policies>
