<?xml version="1.0" encoding="UTF-8"?>
<policies>
    <policy name="/PatientInfoSystem/Patient/name::1">
        <resource type="row" description="Only a patient's doctor can access information about that patient.">
            /PatientInfoSystem/Patient/name
        </resource>
        <permission>
            <value>
                read
            </value>
            <condition>
                <in>
                    <op1>
                        /PatientInfoSystem/Patient(key=thisKey)/name
                    </op1>
                    <op2>
                        /PatientInfoSystem/Doctor(key=user.name)/curr_patients
                    </op2>
                </in>
            </condition>
        </permission>
    </policy>
    <policy>
        <resource type="column" description="Only a patient's doctor can access current_medications about that patient.">
            /PatientInfoSystem/Patient/curr_medications
        </resource>
        <permission>
            <value>
                read
            </value>
            <condition>
                <in>
                    <op1>
                        /PatientInfoSystem/Patient(key=thisKey)/name
                    </op1>
                    <op2>
                        /PatientInfoSystem/Doctor(key=user.name)/curr_patients
                    </op2>
                </in>
            </condition>
        </permission>
    </policy>
    <policy>
        <resource type="column" description="A nurse can access a patient's medical_history only during work hours.">
            /PatientInfoSystem/Patient/medical_history
        </resource>
        <permission>
            <value>
                read
            </value>
            <condition>
                <in>
                    <op1>
                        /PatientInfoSystem/Nurse(key=user.name)/work_hours
                    </op1>
                    <op2>
                        CURRENT_TIME
                    </op2>
                </in>
            </condition>
        </permission>
    </policy>   
    <policy>
        <resource type="column" description="A nurse can access a patient's reports only when the nurse and a doctor are present in patient's room">
            /PatientInfoSystem/Patient/patient_reports
        </resource>
        <permission>
            <value>
                read
            </value>
            <condition>
                <and>
                    <equal>
                        <op1>
                            /PatientInfoSystem/Patient(key=thisKey)/location
                        </op1>
                        <op2>
                            /PatientInfoSystem/Nurse(key=user.name)/location
                        </op2>
                    </equal>
                    <equal>
                        <op1>
                            /PatientInfoSystem/Nurse(key=user.name)/location
                        </op1>
                        <op2>
                            /PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
                        </op2>
                    </equal>
                </and>
            </condition>
        </permission>
    </policy>
    <policy>
        <resource type="row" description="A nurse patient information of only those patients corresponding to the ward in which the nurse is present">
            /PatientInfoSystem/Patient/patient_info
        </resource>
        <permission>
            <value>
                read
            </value>
            <condition>
                <equal>
                    <op1>
                        /PatientInfoSystem/Patient(key=thisKey)/location
                    </op1>
                    <op2>
                        /PatientInfoSystem/Nurse(key=user.name)/location
                    </op2>
                </equal>
            </condition>
        </permission>
    </policy>
</policies>
