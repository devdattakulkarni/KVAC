<?xml version="1.0" encoding="UTF-8"?>
<policies>
    <policy name="/PatientInfoSystem/Patient/name::1">
        <resource type="row" id="policy1" description="I can access all data for a person only if I am his/her family">
            /SocialShare/Person/name
        </resource>
        <permission>
            <value>
                read
            </value>
            <condition>
                <in>
                    <op1>
                        /SocialShare/Person(key=user.name)/name
                    </op1>
                    <op2>
                        /SocialShare/Person(key=thisKey)/family
                    </op2>
                </in>
            </condition>
        </permission>
    </policy>
    <policy name="/PatientInfoSystem/Patient/name::2">
        <resource type="column" id="policy2" description="I can access a person's plan only if I am his/her family">
            /SocialShare/Person/plans
        </resource>
        <permission>
            <value>
                read
            </value>
            <condition>
                <in>
                    <op1>
                        /SocialShare/Person(key=user.name)/name
                    </op1>
                    <op2>
                        /SocialShare/Person(key=thisKey)/family
                    </op2>
                </in>
            </condition>
        </permission>
    </policy>
    <policy>
        <resource type="column" id="policy3" description="A friend can access a person's messages that are max 7 days old">
            /SocialShare/Person/messageId
        </resource>
        <permission>
            <value>
                read
            </value>
            <condition>
                <and>
                    <in>
                        <op1>
                            /SocialShare/Person(key=user.name)/name
                        </op1>
                        <op2>
                            /SocialShare/Person(key=thisKey)/friend
                        </op2>
                    </in>                
                    <in>
                        <op1>
                            /SocialShare/Messages(key=/SocialShare/Person(key=thisKey)/messageId(value=$c))/message_time_stamp				
                        </op1>
                        <op2>
                            <minus>
                                <op1>
                                    CURRENT_TIME
                                </op1>
                                <op2>
                                	Days(7)
                                </op2>
                            </minus>
                        </op2>
                    </in>
                </and>
            </condition>
        </permission>
    </policy>
    
    <!--    <policy>
    <resource type="column">
    /PatientInfoSystem/Patient/curr_medications
    </resource>
    <permission>
    <value>
    read
    </value>
    <condition>
    <in>
    <op1>
    /PatientInfoSystem/Patient(key=thisKey)/name
    </op1>
    <op2>
    /PatientInfoSystem/Doctor(key=user.name)/curr_patients
    </op2>
    </in>
    </condition>
    </permission>
    </policy>
    
    <policy>
    <resource type="column">
    /PatientInfoSystem/Patient/patient_reports
    </resource>
    <permission>
    <value>
    read
    </value>
    <condition>
    <and>
    <equal>
    <op1>
    /PatientInfoSystem/Patient(key=thisKey)/location
    </op1>
    <op2>
    /PatientInfoSystem/Nurse(key=user.name)/location
    </op2>
    </equal>
    <equal>
    <op1>
    /PatientInfoSystem/Nurse(key=user.name)/location
    </op1>
    <op2>
    /PatientInfoSystem/Doctor(key=/PatientInfoSystem/Patient(key=thisKey)/curr_doctor)/location
    </op2>
    </equal>
    </and>
    </condition>
    </permission>
    </policy>
    <policy>
    <resource type="row">
    /PatientInfoSystem/Patient/patient_info
    </resource>
    <permission>
    <value>
    read
    </value>
    <condition>
    <equal>
    <op1>
    /PatientInfoSystem/Patient(key=thisKey)/location
    </op1>
    <op2>
    /PatientInfoSystem/Nurse(key=user.name)/location
    </op2>
    </equal>
    </condition>
    </permission>
    </policy> -->
</policies>
